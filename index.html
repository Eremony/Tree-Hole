<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCFfgJbKzj4yRmL0o4WhRopdEpixV8va3U",
    authDomain: "eremonychat.firebaseapp.com",
    databaseURL: "https://eremonychat-default-rtdb.firebaseio.com",
    projectId: "eremonychat",
    storageBucket: "eremonychat.firebasestorage.app",
    messagingSenderId: "989460520204",
    appId: "1:989460520204:web:341028ab6e4375609afd29",
    measurementId: "G-S34034MY91"
  };

  // 初始化 Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function checkPassword() {
    const password = document.querySelector('#passwordInput').value;
    if (password === 'Eremony') {
      document.getElementById('passwordPrompt').style.display = 'none';
      document.getElementById('chatContainer').style.display = 'block';
      loadMessages();
    } else {
      alert('密码错误，请重试。');
    }
  }

  function sendMessage() {
    const messageInput = document.querySelector('#messageInput');
    const messageText = messageInput.value.trim();
    if (messageText) {
      const timestamp = new Date().toLocaleString();
      db.ref('messages').push({ text: messageText, time: timestamp }, (error) => {
        if (error) {
          console.error('消息发送失败：', error);
          alert('消息发送失败，请检查数据库权限。');
        } else {
          console.log('消息发送成功');
        }
      });
      messageInput.value = '';
    }
  }

  function loadMessages() {
    const messagesList = document.getElementById('messages');
    db.ref('messages').on('child_added', (snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        const messageItem = document.createElement('li');
        messageItem.innerHTML = `${data.text} <span class="timestamp">${data.time}</span>`;
        messagesList.appendChild(messageItem);
      } else {
        console.error('Snapshot does not exist');
      }
    });
  }
</script>
